{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Travel Checker</title>
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 h-screen overflow-hidden">
  <div class="flex h-full">
    <!-- â˜° ë²„íŠ¼ì€ í•­ìƒ ìƒë‹¨ì— ê³ ì • -->
    <button onclick="toggleSidebar()"
      class="bg-[#343949] fixed top-9 left-[18px] text-xl text-white border px-2 py-1 rounded mx-3 my-2" style="z-index:999;">â˜°</button>
    <!-- ì‚¬ì´ë“œë°” -->
    <div id="sidebar"
      class="select-none bg-[#343949] transition-width duration-300 w-64 p-4 relative my-4 rounded">
      <!-- ì‚¬ì´ë“œë°” ë‚´ë¶€ -->
      <div id="sidebarContent" class="border p-2 rounded">
        <!-- ìƒˆì±„íŒ… -->
        <br>
        <br>
        <button class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
          onclick="startNewChat();">
          ğŸ’¬ <span class="tag whitespace-nowrap">&nbsp; ìƒˆì±„íŒ…</span>
        </button>
        <!-- êµ­ê°€ ì„ íƒ -->
        <div id="country-wrapper" class="overflow-y-auto h-[70vh]">
          <button class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
          onclick="selectCountry(this, 'ëŒ€í•œë¯¼êµ­')" data-country="ëŒ€í•œë¯¼êµ­">
            <img width="24" height="24" src="https://img.icons8.com/color/48/south-korea.png" alt="south-korea"/>
            <span class="tag whitespace-nowrap">ëŒ€í•œë¯¼êµ­</span>
          </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
          onclick="selectCountry(this, 'ë² íŠ¸ë‚¨')" data-country="ë² íŠ¸ë‚¨">
          <img width="24" height="24" src="https://img.icons8.com/color/48/vietnam.png" alt="vietnam"/>
          <span class="tag whitespace-nowrap">ë² íŠ¸ë‚¨</span>
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
          onclick="selectCountry(this, 'í™ì½©')" data-country="í™ì½©">
          <img width="24" height="24" src="https://img.icons8.com/color/48/hongkong-flag.png" alt="hongkong-flag"/>
          <span class="tag whitespace-nowrap">í™ì½©</span>
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
          onclick="selectCountry(this, 'ì¼ë³¸')" data-country="ì¼ë³¸">
          <img width="24" height="24" src="https://img.icons8.com/color/48/japan.png" alt="japan"/> 
          <span class="tag whitespace-nowrap">ì¼ë³¸</span>
        </button>

          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ë¯¸êµ­')" data-country="ë¯¸êµ­">
            <img width="24" height="24" src="https://img.icons8.com/color/48/usa.png" alt="usa"/>
            <span class="tag whitespace-nowrap">ë¯¸êµ­</span>
          </button>
          <!-- ì¤‘êµ­ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ì¤‘êµ­')" data-country="ì¤‘êµ­">
            <img width="24" height="24" src="https://img.icons8.com/color/48/china.png" alt="china"/> <span class="tag whitespace-nowrap">ì¤‘êµ­</span>
          </button>

          <!-- ì¸ë„ë„¤ì‹œì•„ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ì¸ë„ë„¤ì‹œì•„')" data-country="ì¸ë„ë„¤ì‹œì•„">
            <img width="24" height="24" src="https://img.icons8.com/color/48/indonesia.png" alt="indonesia"/>
            <span class="tag whitespace-nowrap">ì¸ë„ë„¤ì‹œì•„</span>
          </button>

          <!-- ë§ë ˆì´ì‹œì•„ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ë§ë ˆì´ì‹œì•„')" data-country="ë§ë ˆì´ì‹œì•„">
            <img width="24" height="24" src="https://img.icons8.com/color/48/malaysia.png" alt="malaysia"/>
            <span class="tag whitespace-nowrap">ë§ë ˆì´ì‹œì•„</span>
          </button>

          <!-- í•„ë¦¬í•€ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'í•„ë¦¬í•€')" data-country="í•„ë¦¬í•€">
            <img width="24" height="24" src="https://img.icons8.com/color/48/philippines.png" alt="philippines"/>
            <span class="tag whitespace-nowrap">í•„ë¦¬í•€</span>
          </button>
          <!-- ì‹±ê°€í¬ë¥´ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ì‹±ê°€í¬ë¥´')" data-country="ì‹±ê°€í¬ë¥´">
            <img width="24" height="24" src="https://img.icons8.com/color/48/singapore.png" alt="singapore"/>
            <span class="tag whitespace-nowrap">ì‹±ê°€í¬ë¥´</span>
          </button>

          <!-- ëŒ€ë§Œ -->
          <button
            class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500 flex gap-x-2"
            onclick="selectCountry(this, 'ëŒ€ë§Œ')" data-country="ëŒ€ë§Œ">
            <img width="24" height="24" src="https://img.icons8.com/color/48/taiwan.png" alt="taiwan"/> <span class="tag whitespace-nowrap">ëŒ€ë§Œ</span>
          </button>
      </div>

      <div class="mt-4 flex justify-around footer-wrapper">
          <!-- ë¶ˆëŸ¬ì˜¤ê¸° -->
           <!-- íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ -->
          <button onclick="fileInput.click()"
          class="flex items-center gap-x-1 bg-gray-400 text-white px-2 py-2 rounded hover:bg-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
          </svg>
          <span class="tag whitespace-nowrap">ë¶ˆëŸ¬ì˜¤ê¸°</span>
          </button>
          <!-- ë‚´ë³´ë‚´ê¸° -->
          <button onclick="showExportModal()"
            class="flex items-center bg-gray-400 text-white px-2 py-2 rounded hover:bg-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M19 21H5a2 2 0 01-2-2V7a2 2 0 012-2h4l2-2h2l2 2h4a2 2 0 012 2v12a2 2 0 01-2 2z" />
            </svg>
            <span class="tag whitespace-nowrap">ë‚´ë³´ë‚´ê¸°</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div id="mainContent" class="flex-1 p-4 transition-all duration-300">
      <!-- ì±„íŒ… ì˜ì—­ -->
      <div class="relative h-[70vh] border rounded bg-white mb-4 p-2 flex flex-col justify-end">
        <header class="absolute left-1/2 -translate-x-1/2 text-center text-[#B7B7EF] top-4">
          <h1 class="text-6xl font-bold select-none">travel checker</h1>
        </header>
        <!-- ì•„ë˜ì—ì„œë¶€í„° ì°¨ì˜¤ë¥´ëŠ” ì±„íŒ… -->
        <div id="chatArea" class="container flex flex-col overflow-y-auto" style="z-index: 2;">
          <div class="question text-right m-5 ">
            <div class="inline-block bg-gray-200 rounded p-2 max-w-[80%]">
              ëŒ€ë§Œ ëª…ì†Œ ì¶”ì²œí•´ì¤˜
            </div>
          </div>
          <div class="answer text-left m-5">
            <div class="inline-block bg-gray-300 rounded p-2 max-w-[80%]">
              ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì ¸ê°€ë©´ ì•ˆë  ê²ƒë“¤ì€ í–¥ê¸°ë¹”, í™ê¸°ë¹” ë“±ì…ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>

      <!-- ì§ˆë¬¸ ì…ë ¥ì°½ -->
      <!-- âœ… ì…ë ¥ ì˜ì—­ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” div ì¶”ê°€ -->
      <div id="inputWrapper" class="mt-4"> <!-- â† ì´ ì¤„ ì¶”ê°€ -->
      <!-- (ê²€ìƒ‰ì°½ ìœ„ë¡œ ì´ë™) -->
      <div id="selectedCountry" class="select-none text-lg font-semibold text-yellow-700 mb-2">êµ­ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      <div class="relative mb-2">
        <!-- íŒŒì¼ ì²¨ë¶€ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì•ˆ) -->
        <label for="fileInput"
          class="absolute top-1/2 right-14 -translate-y-1/2 text-gray-500 cursor-pointer hover:text-gray-700">
          <img width="24" height="24" src="https://img.icons8.com/forma-light-filled/24/attach.png" alt="attach"/>
        </label>
          <!-- ì „ì†¡ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ë) -->
          <button onclick="addQuestion()"
            class="select-none absolute top-1/2 right-2 -translate-y-1/2 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">
            â¤
          </button>
          <!-- ì…ë ¥ì°½ -->
          <input type="file" id="fileInput" accept=".json,.txt" class="hidden">
          <input id="questionInput" maxlength="500" class="select-none w-full pr-20 p-2 border rounded"
            placeholder="500ì ì´ë‚´ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.">
        </div>
      <!-- ì¶”ì²œ ì§ˆë¬¸ -->
      <div id="recommendQuestion" class="select-none space-x-2">
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 mb-2 ml-2 rounded">ì—¬í–‰ì§€ ì¶”ì²œí•´ ì£¼ì„¸ìš”</button>
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 mb-2 ml-2 rounded">ë² íŠ¸ë‚¨ ìˆ˜ë„ì˜ ë§›ì§‘ ì¶”ì²œí•´ì£¼ì„¸ìš”</button>
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 mb-2 ml-2 rounded">ë² íŠ¸ë‚¨ì—ì„œ ì¡°ì‹¬í•´ì•¼í•  ì—í‹°ì¼“ì€ ë¬´ì—‡ì¸ê°€ìš”?</button>
      </div>
    </div>
  </div>
  
  <!-- ì˜¤ë²„ë ˆì´ -->
  <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-30 z-10" onclick="hideExportModal()"></div>
  <!-- ëª¨ë‹¬ -->
  <div id="exportModal"
    class="hidden fixed top-1/3 left-1/2 transform -translate-x-1/2 z-20 bg-[#f7f6fb] p-6 rounded-xl shadow-lg w-72 text-center">

    <!-- ë‹«ê¸° ë²„íŠ¼ -->
    <button onclick="hideExportModal()" class="absolute top-3 right-4 text-3xl text-gray-600 hover:text-black">
      &times;
    </button>

    <!-- ë³¸ë¬¸ í…ìŠ¤íŠ¸ -->
    <p class="mb-6 font-medium text-black">
      ì§€ê¸ˆê¹Œì§€ ë‚˜ëˆˆ ëŒ€í™”ë¥¼<br>ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?         {% comment %} ë‹¤ë¥¸ ë‚˜ë¼ í´ë¦­ ì‹œ, Modal ìƒì„± {% endcomment %}
    </p>

    <!-- ì„ íƒ ë²„íŠ¼ -->
    <div class="flex justify-around">
      <button class="export-json text-blue-500 hover:text-blue-600 font-medium" onclick="cleanupAndSwitch('json')">Json</button>
      <button class="export-text text-blue-500 hover:text-blue-600 font-medium" onclick="cleanupAndSwitch('txt')">Text</button>
      <button id="skipBtn" class="export-skip text-yellow-500 hover:text-yellow-600 font-medium" onclick="hideExportModal()">Skip</button>     {% comment %} Skip ë²„íŠ¼ ì¶”ê°€ {% endcomment %}
    </div>
  </div>
  {% comment %} <script>
    window.onload = insertWelcomeMessage;
  </script> {% endcomment %}
  <form method="POST" id="refreshForm" action="{% url 'getRefresHistory' %}" style="display:none;">
    {% csrf_token %}
    <input type="json" id="historyInput" name="history">
    <input type="submit">
  </form>
  <script src="{% static 'js/script.js' %}"></script>
  <script>
    async function refreshChat(history){
      if (history){
        console.log(history)
        const formData = new FormData(refreshForm);
        formData.set("history", JSON.stringify(history));  // history ê°±ì‹ 
      
        fetch("/api/refresh/history", {
          method: "POST",
          body: formData,
        })
        .then(response => response.json())
        .then(data => {
          console.log("ì‘ë‹µ ë°ì´í„°:", data);
          // í•„ìš” ì‹œ ì—¬ê¸°ì„œ í™”ë©´ ì—…ë°ì´íŠ¸
        })
        .catch(error => {
          console.error("ì—ëŸ¬ ë°œìƒ:", error);
        });
      }
      else {
        try {
          const response = await fetch('api/refresh', {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
          }
          });
          const data = await response.json();
          console.log(data);
          console.log("ì´ˆê¸°í™” ì„±ê³µ");
        } catch (error) {
          console.error("Error:", error);
        }
      }
    }
  </script>
</body>
</html>