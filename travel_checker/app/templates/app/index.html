{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Travel Checker</title>
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 h-screen overflow-hidden">
  <div class="flex h-full">

    <!-- ì‚¬ì´ë“œë°” -->
    <div id="sidebar"
      class="select-none bg-[#343949] transition-width duration-300 w-64 p-4 relative my-4 rounded mx-2">
      <!-- â˜° ë²„íŠ¼ì€ í•­ìƒ ìƒë‹¨ì— ê³ ì • -->
      <button onclick="toggleSidebar()"
        class="bg-[#343949] absolute top-5 left-4 text-xl text-white border px-2 py-1 rounded mx-3 my-2">â˜°</button>

      <!-- ì‚¬ì´ë“œë°” ë‚´ë¶€ -->
      <div id="sidebarContent" class="border p-2 rounded">
        <!-- ìƒˆì±„íŒ… -->
        <br>
        <br>
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="location.reload();">
          ğŸ’¬ ìƒˆì±„íŒ…
        </button>

        <!-- êµ­ê°€ ì„ íƒ -->
         <div id="country-wrapper" class="overflow-y-auto max-h-[75vh]">
          <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ëŒ€í•œë¯¼êµ­')">
          ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ë² íŠ¸ë‚¨')">
          ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'í™ì½©')">
          ğŸ‡­ğŸ‡° í™ì½©
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ì¼ë³¸')">
          ğŸ‡¯ğŸ‡µ ì¼ë³¸
        </button>

        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ë¯¸êµ­')">
          ğŸ‡ºğŸ‡¸ ë¯¸êµ­
        </button>
        <!-- ì¤‘êµ­ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ì¤‘êµ­')">
          ğŸ‡¨ğŸ‡³ ì¤‘êµ­
        </button>

        <!-- ì¸ë„ë„¤ì‹œì•„ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ì¸ë„ë„¤ì‹œì•„')">
          ğŸ‡®ğŸ‡© ì¸ë„ë„¤ì‹œì•„
        </button>

        <!-- ë§ë ˆì´ì‹œì•„ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ë§ë ˆì´ì‹œì•„')">
          ğŸ‡²ğŸ‡¾ ë§ë ˆì´ì‹œì•„
        </button>

        <!-- í•„ë¦¬í•€ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'í•„ë¦¬í•€')">
          ğŸ‡µğŸ‡­ í•„ë¦¬í•€
        </button>
        <!-- ì‹±ê°€í¬ë¥´ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ì‹±ê°€í¬ë¥´')">
          ğŸ‡¸ğŸ‡¬ ì‹±ê°€í¬ë¥´
        </button>

        <!-- ëŒ€ë§Œ -->
        <button
          class="country-button w-full py-2 mb-2 p-4 text-left rounded-md bg-[#0A0C19] text-white hover:bg-gray-500"
          onclick="selectCountry(this, 'ëŒ€ë§Œ')">
          ğŸ‡¹ğŸ‡¼ ëŒ€ë§Œ
        </button>
        </div>

        <div class="mt-4 flex space-x-2 justify-around">
          <!-- ë¶ˆëŸ¬ì˜¤ê¸° -->
          <label
            class="flex items-center gap-x-1 bg-gray-400 text-white px-2 py-2 rounded cursor-pointer hover:bg-gray-500">
            <span class="text-lg">ï¼‹</span>
            <span>ë¶ˆëŸ¬ì˜¤ê¸°</span>
            <input type="file" id="fileInput1" accept=".json,.txt" class="hidden">
          </label>

          <!-- ë‚´ë³´ë‚´ê¸° -->
          <button onclick="showExportModal()"
            class="flex items-center gap-x-1 bg-gray-400 text-white px-2 py-2 rounded hover:bg-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M19 21H5a2 2 0 01-2-2V7a2 2 0 012-2h4l2-2h2l2 2h4a2 2 0 012 2v12a2 2 0 01-2 2z" />
            </svg>
            <span>ë‚´ë³´ë‚´ê¸°</span>
          </button>
        </div>

      </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div id="mainContent" class="flex-1 p-4 transition-all duration-300">
      <!-- ì±„íŒ… ì˜ì—­ -->
      <div class="relative h-[70%] border rounded bg-white mb-4 p-2 flex flex-col justify-end">
        <header class="absolute left-1/2 -translate-x-1/2 text-center text-[#B7B7EF] top-4">
          <h1 class="text-6xl font-bold select-none">travel checker</h1>
        </header>
        <!-- ì•„ë˜ì—ì„œë¶€í„° ì°¨ì˜¤ë¥´ëŠ” ì±„íŒ… -->
        <div id="chatArea" class="container flex flex-col overflow-y-auto" style="z-index: 2;">
          <div class="question text-right m-5 ">
            <div class="inline-block bg-gray-200 rounded p-2 max-w-[80%]">
              ëŒ€ë§Œ ëª…ì†Œ ì¶”ì²œí•´ì¤˜
            </div>
          </div>
          <div class="answer text-left m-5">
            <div class="inline-block bg-gray-300 rounded p-2 max-w-[80%]">
              ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì ¸ê°€ë©´ ì•ˆë  ê²ƒë“¤ì€ í–¥ê¸°ë¹”, í™ê¸°ë¹” ë“±ì…ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>

      <!-- ì§ˆë¬¸ ì…ë ¥ì°½ -->
      <!-- ì„ íƒëœ êµ­ê°€ (ê²€ìƒ‰ì°½ ìœ„ë¡œ ì´ë™) -->
      <div id="selectedCountry" class="select-none text-lg font-semibold text-yellow-700 mb-2">êµ­ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      <div class="relative mb-2">
        <!-- íŒŒì¼ ì²¨ë¶€ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì•ˆ) -->
        <label for="fileInput"
          class="absolute top-1/2 right-14 -translate-y-1/2 text-gray-500 cursor-pointer hover:text-gray-700">
          ğŸ“
        </label>
        <input type="file" id="fileInput" accept=".json,.txt" class="hidden">

        <!-- ì „ì†¡ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ë) -->
        <button onclick="addQuestion()"
          class="select-none absolute top-1/2 right-2 -translate-y-1/2 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">
          â¤
        </button>

        <!-- ì…ë ¥ì°½ -->
        <input id="questionInput" maxlength="500" class="select-none w-full pr-20 p-2 border rounded"
          placeholder="500ì ì´ë‚´ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.">
      </div>

      <!-- ì¶”ì²œ ì§ˆë¬¸ -->
      <div class="select-none space-x-2">
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 rounded">ì—¬í–‰ì§€ ì¶”ì²œí•´ ì£¼ì„¸ìš”</button>
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 rounded">ë² íŠ¸ë‚¨ ìˆ˜ë„ì˜ ë§›ì§‘ ì¶”ì²œí•´ì£¼ì„¸ìš”</button>
        <button onclick="insertSuggested()" class="bg-gray-300 px-3 py-1 rounded">ë² íŠ¸ë‚¨ì—ì„œ ì¡°ì‹¬í•´ì•¼í•  ì—í‹°ì¼“ì€ ë¬´ì—‡ì¸ê°€ìš”?</button>
      </div>
    </div>
  </div>

  <!-- ì˜¤ë²„ë ˆì´ -->
  <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-30 z-10" onclick="hideExportModal()"></div>
  <!-- ëª¨ë‹¬ -->
  <div id="exportModal"
    class="hidden fixed top-1/3 left-1/2 transform -translate-x-1/2 z-20 bg-[#f7f6fb] p-6 rounded-xl shadow-lg w-72 text-center">

    <!-- ë‹«ê¸° ë²„íŠ¼ -->
    <button onclick="hideExportModal()" class="absolute top-3 right-4 text-3xl text-gray-600 hover:text-black">
      &times;
    </button>

    <!-- ë³¸ë¬¸ í…ìŠ¤íŠ¸ -->
    <p class="mb-6 font-medium text-black">
      ì§€ê¸ˆê¹Œì§€ ë‚˜ëˆˆ ëŒ€í™”ë¥¼<br>ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?         {% comment %} ë‹¤ë¥¸ ë‚˜ë¼ í´ë¦­ ì‹œ, Modal ìƒì„± {% endcomment %}
    </p>

    <!-- ì„ íƒ ë²„íŠ¼ -->
    <div class="flex justify-around">

      <button class="export-json text-blue-500 hover:text-blue-600 font-medium">Json</button>
      <button class="export-text text-blue-500 hover:text-blue-600 font-medium">Text</button>
      <button class="export-skip text-yellow-500 hover:text-yellow-600 font-medium">Skip</button>     {% comment %} Skip ë²„íŠ¼ ì¶”ê°€ {% endcomment %}
      
    </div>
  </div>

  <script src="{% static 'js/script.js' %}"></script>


  {% comment %} 25_04_20(ì¼) Testing.. {% endcomment %}
  {% comment %} <script>
    let selectCountryName ="";

    function selectCountry(button, CountryName){
      selectCountryName = CountryName;
      document.getElementById("selectedCountry").innerText = CountryName;
    }

    function addQuestion() {
      const input = document.getElementById("questionInput");
      const chatArea = document.getElementById("chatArea");
      const question = input.value.trim();
      const country = selectCountryName;
  
      if (!question || !country) {
        alert("ì§ˆë¬¸ê³¼ êµ­ê°€ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
  
      const userDiv = document.createElement("div");
      userDiv.className = "question text-right m-5";
      userDiv.innerHTML = `<div class="inline-block bg-gray-200 rounded p-2 max-w-[80%]">${question}</div>`;
      chatArea.appendChild(userDiv);
      input.value = "";
  
      fetch("/api/chat/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          user_message: question,
          country: country,
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          const answer = data.answer;
          const botDiv = document.createElement("div");
          botDiv.className = "answer text-left m-5";
          botDiv.innerHTML = `<div class="inline-block bg-gray-300 rounded p-2 max-w-[80%]">${answer}</div>`;
          chatArea.appendChild(botDiv);
          chatArea.scrollTop = chatArea.scrollHeight;
        })
        .catch((err) => {
          console.error("ì—ëŸ¬ ë°œìƒ:", err);
        });
    }
  
    // ì—”í„°í‚¤ ì „ì†¡ ì²˜ë¦¬
    document.getElementById("questionInput").addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        addQuestion();
      }
    });
  
    // ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì‚½ì…
    function insertSuggested() {
      const text = event.target.innerText;
      document.getElementById("questionInput").value = text;
    }
  </script> {% endcomment %}
  
  {% comment %} 25_04_20(ì¼) Testing.. {% endcomment %}


</body>

</html>